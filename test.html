<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>학생 점수 계산</title>
</head>
<body>
  <h1>학생 점수 계산</h1>

  <label for="studentSelect">학생 이름:</label>
  <select id="studentSelect"></select>

  <label for="schoolSelect">학교명:</label>
  <select id="schoolSelect"></select>

  <label for="majorSelect">전공:</label>
  <select id="majorSelect"></select>

  <button onclick="calculateScore()">점수 계산</button>

  <h2>계산 결과</h2>
  <p id="result">점수를 계산해주세요.</p>
  <div id="logs"></div> <!-- 로그를 보여줄 공간 -->

  <script>
    // 학생 목록 불러오기
    fetch('https://supermax.kr/api/students')
      .then(response => response.json())
      .then(data => {
        const studentSelect = document.getElementById('studentSelect');
        data.forEach(student => {
          const option = document.createElement('option');
          option.value = student.이름;
          option.textContent = student.이름;
          studentSelect.appendChild(option);
        });
      });

    // 학교 목록 불러오기
    fetch('https://supermax.kr/api/schools')
      .then(response => response.json())
      .then(data => {
        const schoolSelect = document.getElementById('schoolSelect');
        const majorSelect = document.getElementById('majorSelect');
        
        const uniqueSchools = [...new Set(data.map(s => s.학교명))];
        uniqueSchools.forEach(school => {
          const option = document.createElement('option');
          option.value = school;
          option.textContent = school;
          schoolSelect.appendChild(option);
        });

        schoolSelect.addEventListener('change', () => {
          majorSelect.innerHTML = '';
          const selectedSchool = schoolSelect.value;
          const majors = data.filter(s => s.학교명 === selectedSchool);
          majors.forEach(major => {
            const option = document.createElement('option');
            option.value = major.전공;
            option.textContent = major.전공;
            majorSelect.appendChild(option);
          });
        });
      });

    // 점수 계산 함수
    function calculateScore() {
      const studentName = document.getElementById('studentSelect').value;
      const schoolName = document.getElementById('schoolSelect').value;
      const major = document.getElementById('majorSelect').value;

      fetch('https://supermax.kr/api/calculate-score', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ studentName, schoolName, major })
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('result').textContent = `최종 점수: ${data.totalScore}`;

        const logsDiv = document.getElementById('logs');
        logsDiv.innerHTML = '<h3>계산 로그</h3>';
        data.logs.forEach(log => {
          const logItem = document.createElement('p');
          logItem.textContent = log;
          logsDiv.appendChild(logItem);
        });
      });
    }
  </script>
</body>
</html>
