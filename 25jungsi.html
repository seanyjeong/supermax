<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>25학년도 정시모집요강 -일산맥스-</title>
<link rel="icon" type="image/gif" href="https://github.com/seanyjeong/max24liveM/blob/main/max.gif?raw=true">
<style>
  body {
    background-color: black;
    color: white;
    margin: 0;
    padding: 0;
  }
  .header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: black;
    padding: 10px;
    z-index: 1000;
    border-bottom: 1px solid white;
  }
  .filter-container {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    margin-top: 10px;
  }
  .filter-group {
    display: inline-block;
    margin-right: 20px;
    margin-left: 20px;
  }
  .filter-legend {
    display: block;
    font-weight: bold;
    color: white;
    margin-bottom: 2px;
  }
  .filter-legend.red {
    color: red;
  }
  .filter-option {
    display: inline-block;
    margin: 5px;
    padding: 5px;
    border: 1px solid #ddd;
    cursor: pointer;
    background-color: black;
    color: white;
    border-radius: 10px;
  }
  .filter-option.selected {
    background-color: #007bff;
    color: white;
  }
  table {
    width: 100%;
    table-layout: fixed;
    border-collapse: collapse;
    margin-top: 160px; /* 헤더 아래 공간 확보 */
    color: white;
    background-image: url('https://github.com/seanyjeong/supermax/blob/main/maxlogo%20(2).png?raw=true');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
  }
  table, th, td {
    border: 1px solid white;
  }
  th, td {
    padding: 8px;
    text-align: center;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  th {
    background-color: #333;
  }
  .col-1 { width: 30px; }
  .col-2 { width: 60px; }
  .col-3 { width: 60px; }
  .col-4 { width: 60px; }
  .col-5 { width: 120px; }
  .col-6 { width: 135px; }
  .col-7 { width: auto; }
  .button-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 10px;
  }
  .button-container button {
    padding: 10px 20px;
    margin: 0 10px;
    background-color: black;
    color: white;
    border: 1px solid white;
    cursor: pointer;
    border-radius: 10px;
    width: 150px;
    text-align: center;
  }
  .count-display {
    font-size: 16px;
    margin-left: 10px;
    color: white;
  }
  h1 {
    text-align: center;
    color: white;
    margin-top: 120px; /* 헤더 아래 공간 확보 */
  }
  .highlighted-row {
    background-color: #555;
  }
  .full-text {
    overflow: visible;
    white-space: normal;
  }
  .header-group-1 {
    background-color: #ffcccb;
    color: black;
  }
  .header-group-2 {
    background-color: #add8e6;
    color: black;
  }
  .header-group-3 {
    background-color: #90ee90;
    color: black;
  }
  .header-group-4 {
    background-color: #dda0dd;
    color: black;
  }
  .header-group-5 {
    background-color: #ffcc99;
    color: black;
  }
  .header-group-6 {
    background-color: #ffb6c1;
    color: black;
  }
  .screenshot-button {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 10px;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
    padding-top: 60px;
  }
  .modal-content {
    background-color: black;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid white;
    width: 90%;
    max-width: 600px;
    color: white;
    overflow-x: auto;
    position: relative;
  }
  .modal-content table {
    width: 100%;
    border-collapse: collapse;
  }
  .modal-content th, .modal-content td {
    border: 1px solid white;
    padding: 5px;
    text-align: left;
    white-space: nowrap;
  }
  .close-button {
    display: block;
    margin: 0 auto 20px;
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 10px;
    text-align: center;
    font-size: 18px;
  }
</style>
</head>
<body>

<div class="header">
  <div class="filter-container">
    <div id="filters" class="filter-container"></div>
    <div class="button-container">
      <button onclick="clearFilters()">모두 해제</button>
      <button id="search-button" onclick="applyFilters()">검색</button>
      <span class="count-display">선택된 학교 : 0 개</span>
    </div>
  </div>
</div>

<h1>25학년도 정시모집요강 -일산맥스-</h1>

<button class="screenshot-button" onclick="captureScreenshot()">스크린샷</button>

<table id="data-table">
  <thead>
    <tr id="headers"></tr>
  </thead>
  <tbody id="table-body"></tbody>
</table>

<!-- 모달 창 -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <button class="close-button" onclick="closeModal()">닫기</button>
    <div id="modal-content-container"></div>
  </div>
</div>

<!-- 최신 버전의 html2canvas 라이브러리 CDN 추가 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
let filteredData = [];

function fetchData() {
  fetch('https://supermax.kr:3000/25jeongsi')
    .then(response => response.json())
    .then(data => {
      createFilterOptions(data, '군');
      createFilterOptions(data, '형태');
      createFilterOptions(data, '지역');
      createFilterOptions(data, '교직');
      createSubjectExclusionFilter(data, ['국어', '수학', '영어', '탐구']);
      createFilterOptionsFromData(data, '탐구반영갯수');
      createSkillExclusionFilter(data, ['실기1', '실기2', '실기3', '실기4', '실기5', '실기6']);
      filteredData = data;
      updateTable();
      updateCountDisplay();
    })
    .catch(error => console.error('Error fetching data:', error));
}

function createFilterOptionsFromData(data, field) {
  const uniqueValues = Array.from(new Set(data.map(item => item[field])))
    .filter(value => value !== 0 && value !== null)
    .sort((a, b) => a - b);
  const filterContainer = document.getElementById('filters');
  const fieldSet = document.createElement('div');
  fieldSet.classList.add('filter-group');
  const legend = document.createElement('span');
  legend.classList.add('filter-legend');
  legend.textContent = field;
  fieldSet.appendChild(legend);

  uniqueValues.forEach(value => {
    const filterOption = document.createElement('div');
    filterOption.classList.add('filter-option');
    filterOption.textContent = value;
    filterOption.onclick = function() {
      this.classList.toggle('selected');
    };
    fieldSet.appendChild(filterOption);
  });

  filterContainer.appendChild(fieldSet);
}

function createFilterOptions(data, field) {
  const uniqueValues = Array.from(new Set(data.map(item => item[field])))
    .filter(value => value !== 0 && value !== null)
    .sort();
  const filterContainer = document.getElementById('filters');
  const fieldSet = document.createElement('div');
  fieldSet.classList.add('filter-group');
  const legend = document.createElement('span');
  legend.classList.add('filter-legend');
  legend.textContent = field;
  fieldSet.appendChild(legend);

  uniqueValues.forEach(value => {
    const filterOption = document.createElement('div');
    filterOption.classList.add('filter-option');
    filterOption.textContent = value;
    filterOption.onclick = function() {
      this.classList.toggle('selected');
    };
    fieldSet.appendChild(filterOption);
  });

  filterContainer.appendChild(fieldSet);
}

function createSubjectExclusionFilter(data, fields) {
  const filterContainer = document.getElementById('filters');
  const fieldSet = document.createElement('div');
  fieldSet.classList.add('filter-group');
  const legend = document.createElement('span');
  legend.classList.add('filter-legend', 'red');
  legend.textContent = '과목 제외';
  fieldSet.appendChild(legend);

  fields.forEach(field => {
    const filterOption = document.createElement('div');
    filterOption.classList.add('filter-option');
    filterOption.textContent = field;
    filterOption.onclick = function() {
      this.classList.toggle('selected');
    };
    fieldSet.appendChild(filterOption);
  });

  filterContainer.appendChild(fieldSet);
}

function createSkillExclusionFilter(data, fields) {
  const filterContainer = document.getElementById('filters');
  const fieldSet = document.createElement('div');
  fieldSet.classList.add('filter-group');
  const legend = document.createElement('span');
  legend.classList.add('filter-legend', 'red');
  legend.textContent = '실기 제외';
  fieldSet.appendChild(legend);

  const allSkills = [];
  data.forEach(item => {
    fields.forEach(skill => {
      const value = item[skill];
      if (value && !allSkills.includes(value)) {
        allSkills.push(value);
      }
    });
  });

  allSkills.sort();

  allSkills.forEach(skill => {
    const filterOption = document.createElement('div');
    filterOption.classList.add('filter-option');
    filterOption.textContent = skill;
    filterOption.onclick = function() {
      this.classList.toggle('selected');
    };
    fieldSet.appendChild(filterOption);
  });

  filterContainer.appendChild(fieldSet);
}

function applyFilters() {
  fetch('https://supermax.kr:3000/25jeongsi')
    .then(response => response.json())
    .then(data => {
      const selectedFilters = {};
      document.querySelectorAll('.filter-option.selected').forEach(filterOption => {
        const field = filterOption.parentNode.querySelector('span').textContent.replace(' 제외', '');
        if (!selectedFilters[field]) {
          selectedFilters[field] = [];
        }
        selectedFilters[field].push(filterOption.textContent);
      });

      filteredData = data.filter(item => {
        return Object.keys(selectedFilters).every(field => {
          if (field === '과목') {
            return selectedFilters[field].every(subject => {
              return (
                item[subject] === null || 
                item[subject] === '' || 
                /\(.*?\)/.test(item[subject])
              );
            });
          } else if (field === '실기') {
            const excludedSkills = selectedFilters[field];
            return !excludedSkills.some(skill => {
              for (let i = 1; i <= 6; i++) {
                if (item[`실기${i}`] === skill) {
                  return true;
                }
              }
              return false;
            });
          } else if (field === '탐구반영갯수') {
            const selectedNumbers = selectedFilters[field].map(Number);
            return selectedNumbers.includes(item[field]);
          }
          return selectedFilters[field].includes(item[field]);
        });
      });

      updateTable();
      updateCountDisplay();
    })
    .catch(error => console.error('Error fetching data:', error));
}

function clearFilters() {
  document.querySelectorAll('.filter-option.selected').forEach(filterOption => {
    filterOption.classList.remove('selected');
  });
  applyFilters();
}

function handleRowClick(event) {
  const isMobile = window.innerWidth <= 768;

  if (isMobile) {
    const rowContent = Array.from(event.currentTarget.cells).map(cell => cell.textContent);
    const headers = Array.from(document.getElementById('headers').children).map(header => header.textContent);
    
    const modalContentContainer = document.getElementById('modal-content-container');
    modalContentContainer.innerHTML = '';

    const fieldGroups = [
      ['군', '형태', '지역', '교직'],
      ['대학명', '학과명'],
      ['전형명', '모집인원', '반영방법'],
      ['수능', '내신', '실기', '기타'],
      ['국어', '수학', '영어', '탐구', '탐구반영갯수', '한국사'],
      ['실기1', '실기2', '실기3', '실기4', '실기5', '실기6']
    ];

    const table = document.createElement('table');

    fieldGroups.forEach(group => {
      group.forEach(field => {
        const index = headers.indexOf(field);
        if (index !== -1) {
          const tr = document.createElement('tr');
          const th = document.createElement('th');
          const td = document.createElement('td');
          th.textContent = field;
          td.textContent = rowContent[index];
          tr.appendChild(th);
          tr.appendChild(td);
          table.appendChild(tr);
        }
      });
    });

    modalContentContainer.appendChild(table);
    document.getElementById('myModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
  } else {
    const allRows = document.querySelectorAll('tr');
    allRows.forEach(row => {
      row.classList.remove('highlighted-row');
      row.querySelectorAll('td').forEach(cell => {
        cell.classList.remove('full-text');
      });
    });
    event.currentTarget.classList.add('highlighted-row');
    event.currentTarget.querySelectorAll('td').forEach(cell => {
      cell.classList.add('full-text');
    });
  }
}

function closeModal() {
  document.getElementById('myModal').style.display = 'none';
  document.body.style.overflow = 'auto';
}

function updateTable() {
  const headers = Object.keys(filteredData[0] || {}).filter(header => header !== 'ID');
  const tableHead = document.getElementById('headers');
  const tableBody = document.getElementById('table-body');

  tableHead.innerHTML = '';
  tableBody.innerHTML = '';

  headers.forEach((header, index) => {
    const headerElement = document.createElement('th');
    headerElement.textContent = header;

    if (['군', '형태', '지역', '교직'].includes(header)) {
      headerElement.classList.add('header-group-1');
    } else if (['대학명', '학과명'].includes(header)) {
      headerElement.classList.add('header-group-2');
    } else if (['전형명', '모집인원', '반영방법'].includes(header)) {
      headerElement.classList.add('header-group-3');
    } else if (['수능', '내신', '실기', '기타'].includes(header)) {
      headerElement.classList.add('header-group-4');
    } else if (['국어', '수학', '영어', '탐구', '탐구반영갯수', '한국사'].includes(header)) {
      headerElement.classList.add('header-group-5');
    } else if (['실기1', '실기2', '실기3', '실기4', '실기5', '실기6'].includes(header)) {
      headerElement.classList.add('header-group-6');
    }
    headerElement.classList.add(`col-${index + 1}`);
    tableHead.appendChild(headerElement);
  });

  filteredData.forEach(row => {
    const rowElement = document.createElement('tr');
    headers.forEach((header, index) => {
      const cell = document.createElement('td');
      cell.textContent = row[header];
      cell.classList.add(`col-${index + 1}`);
      rowElement.appendChild(cell);
    });

    rowElement.addEventListener('click', handleRowClick);

    tableBody.appendChild(rowElement);
  });
}

function updateCountDisplay() {
  const countDisplay = document.querySelector('.count-display');
  countDisplay.textContent = `선택된 학교 : ${filteredData.length} 개`;
}

function captureScreenshot() {
  html2canvas(document.body).then(canvas => {
    const link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = 'screenshot.png';
    link.click();
  });
}

window.onload = fetchData;
</script>

</body>
<footer style="margin-top: 3rem; text-align: center;">
  <p>© 2024 맥스체대입시 일산교육원. All rights reserved.</p>
</footer>
</html>
