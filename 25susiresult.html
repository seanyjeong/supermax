<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>맥스체대입시 25수시 실시간 조회</title>
    <style>
        /* 타이틀을 중앙 정렬 */
        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
        }

        /* 필터 및 타이틀 고정 */
        .sticky-container {
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 1000;
            padding: 10px;
            border-bottom: 2px solid #ddd;
        }

        /* 전체 필터 영역을 가로로 배치, 요소 간격을 줄이기 */
        .filter-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-container label {
            font-size: 18px;
            font-weight: bold;
            margin-right: 5px;
        }

        .filter-container select, .filter-container input, .filter-container button {
            width: 180px;
            padding: 8px;
            font-size: 16px;
        }

        /* 검색 버튼 크기를 네모칸과 맞추기 */
        .filter-container button {
            width: 180px;
            cursor: pointer;
        }

        /* 테이블 컨테이너로 본문만 스크롤 가능 */
        .table-container {
            max-height: 400px; /* 테이블의 최대 높이를 설정 */
            overflow-y: auto; /* 테이블 본문만 스크롤 가능하게 설정 */
        }

        /* 표 전체 스타일 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        /* 표 헤더 스타일 */
        th, td {
            text-align: center;
            padding: 10px;
            font-size: 14px;
            white-space: nowrap;
            border: 1px solid #ddd;
        }

        /* 고정된 헤더 스타일 */
        thead th {
            position: sticky;
            top: 0;
            background-color: #4CAF50;
            color: white;
            z-index: 100;
        }

        /* 마우스를 올릴 때 행 강조 */
        tr:hover {
            background-color: #f1f1f1;
        }

        /* 표 기본 폰트 스타일 */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        /* 반응형 처리 */
        @media screen and (max-width: 768px) {
            td, th {
                font-size: 12px;
            }

            .filter-container {
                flex-wrap: wrap;
            }

            .filter-container select, .filter-container input, .filter-container button {
                width: 100%;
            }
        }
    </style>
    <script>
        // 슈퍼맥스 서버에서 데이터를 가져오는 함수
        async function fetchDropdownData() {
            try {
                const response = await fetch('https://supermax.kr/25susi-dropdowns');
                const data = await response.json();
                populateDropdown('university', data.universities);
            } catch (error) {
                console.error('Error fetching dropdown data from supermax.kr:', error);
            }
        }

        function populateDropdown(elementId, items) {
            const select = document.getElementById(elementId);
            select.innerHTML = `<option value="">선택하세요</option>`;
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.text = item;
                select.appendChild(option);
            });
        }

        // 필터링된 데이터를 가져와 표시하는 함수
        async function fetchFilteredData() {
            const university = document.getElementById('university').value;
            const major = document.getElementById('major').value;
            const admissionType = document.getElementById('admissionType').value;

            if (!university || !major || !admissionType) {
                return;
            }

            try {
                const response = await fetch(`https://supermax.kr/25susi-filter?university=${university}&major=${major}&admissionType=${admissionType}`);
                const data = await response.json();
                displayData(data);
            } catch (error) {
                console.error('Error fetching filtered data from supermax.kr:', error);
            }
        }

        // 결과 데이터를 화면에 표시하는 함수 (총점 내림차순 정렬, 순위 추가)
        function displayData(data) {
            const resultTableHead = document.getElementById('resultTableHead');
            const resultTableBody = document.getElementById('resultTableBody');
            resultTableHead.innerHTML = '';
            resultTableBody.innerHTML = '';

            if (data.length === 0) {
                return;
            }

            data.sort((a, b) => b.총점 - a.총점);

            let headers = `
                <th>순위</th>
                <th>교육원</th>
                <th>이름</th>
                <th>학교</th>
                <th>성별</th>
                <th>학년</th>
                <th>환산내신</th>
                <th>등급</th>
                <th>실기점수</th>
                <th>총점</th>
                <th>최초합격여부</th>
                <th>최종합격여부</th>
            `;

            resultTableHead.innerHTML = `<tr>${headers}</tr>`;

            data.forEach((row, index) => {
                let rowHtml = `
                    <td>${index + 1}</td>
                    <td>${row.교육원 || ''}</td>
                    <td>${row.이름 || ''}</td>
                    <td>${row.학교 || ''}</td>
                    <td>${row.성별 || ''}</td>
                    <td>${row.학년 || ''}</td>
                    <td>${row.환산내신 || ''}</td>
                    <td>${row.등급 || ''}</td>
                    <td>${row.실기점수 || ''}</td>
                    <td>${row.총점 || ''}</td>
                    <td>${row.최초합격여부 || ''}</td>
                    <td>${row.최종합격여부 || ''}</td>
                `;

                resultTableBody.innerHTML += `<tr>${rowHtml}</tr>`;
            });
        }

        // 검색어를 포함하는 행의 배경색을 변경하는 함수
        function highlightRows() {
            const searchKeyword = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('tbody tr');

            rows.forEach(row => {
                row.style.backgroundColor = '';
                const cells = Array.from(row.cells).map(cell => cell.textContent.toLowerCase());

                if (cells.some(cell => cell.includes(searchKeyword))) {
                    row.style.backgroundColor = 'yellow';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchDropdownData();

            document.getElementById('university').addEventListener('change', async () => {
                const university = document.getElementById('university').value;
                if (university) {
                    try {
                        const response = await fetch(`https://supermax.kr/25susi-majors?university=${university}`);
                        const data = await response.json();
                        populateDropdown('major', data.majors);
                    } catch (error) {
                        console.error('Error fetching majors from supermax.kr:', error);
                    }
                }
                fetchFilteredData();
            });

            document.getElementById('major').addEventListener('change', async () => {
                const university = document.getElementById('university').value;
                const major = document.getElementById('major').value;
                if (university && major) {
                    try {
                        const response = await fetch(`https://supermax.kr/25susi-admissionTypes?university=${university}&major=${major}`);
                        const data = await response.json();
                        populateDropdown('admissionType', data.admissionTypes);
                    } catch (error) {
                        console.error('Error fetching admission types from supermax.kr:', error);
                    }
                }
                fetchFilteredData();
            });

            document.getElementById('admissionType').addEventListener('change', fetchFilteredData);
            document.getElementById('searchButton').addEventListener('click', highlightRows);
        });
    </script>
</head>
<body>

    <!-- 타이틀 및 필터 고정 영역 -->
    <div class="sticky-container">
        <h1>맥스체대입시 25수시 실시간 조회</h1>
        <div class="filter-container">
            <div>
                <label for="university">대학명:</label>
                <select id="university"></select>
            </div>
            <div>
                <label for="major">학과명:</label>
                <select id="major"></select>
            </div>
            <div>
                <label for="admissionType">전형명:</label>
                <select id="admissionType"></select>
            </div>
            <div>
                <label for="searchInput">검색어:</label>
                <input type="text" id="searchInput" placeholder="텍스트 입력">
            </div>
            <div>
                <button id="searchButton">검색</button>
            </div>
        </div>
    </div>

    <!-- 테이블 본문만 스크롤 가능하게 설정 -->
    <div class="table-container">
        <table>
            <thead id="resultTableHead"></thead>
            <tbody id="resultTableBody"></tbody>
        </table>
    </div>
</body>
</html>
