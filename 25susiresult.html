<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25susiresult 조회</title>
    <style>
        /* 표 전체 스타일 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        /* 표 헤더 스타일 */
        th {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            white-space: nowrap;
        }

        /* 표 셀 스타일 */
        td {
            text-align: center;
            padding: 10px;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
            border-bottom: 1px solid #ddd;
        }

        /* 마우스를 올릴 때 행 강조 */
        tr:hover {
            background-color: #f1f1f1;
        }

        /* 테이블 외곽선 */
        table, td, th {
            border: 1px solid #ddd;
        }

        /* 표 기본 폰트 스타일 */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        /* 반응형 처리 */
        @media screen and (max-width: 768px) {
            td, th {
                font-size: 12px;
            }
        }
    </style>
    <script>
        // 슈퍼맥스 서버에서 데이터를 가져오는 함수
        async function fetchDropdownData() {
            try {
                const response = await fetch('https://supermax.kr/25susi-dropdowns');
                const data = await response.json();
                populateDropdown('university', data.universities);
            } catch (error) {
                console.error('Error fetching dropdown data from supermax.kr:', error);
            }
        }

        function populateDropdown(elementId, items) {
            const select = document.getElementById(elementId);
            select.innerHTML = `<option value="">선택하세요</option>`;
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.text = item;
                select.appendChild(option);
            });
        }

        // 필터링된 데이터를 가져와 표시하는 함수
        async function fetchFilteredData() {
            const university = document.getElementById('university').value;
            const major = document.getElementById('major').value;
            const admissionType = document.getElementById('admissionType').value;

            if (!university || !major || !admissionType) {
                return; // 모든 드롭다운 값이 선택된 후에만 데이터 가져오기
            }

            try {
                const response = await fetch(`https://supermax.kr/25susi-filter?university=${university}&major=${major}&admissionType=${admissionType}`);
                const data = await response.json();
                displayData(data);
            } catch (error) {
                console.error('Error fetching filtered data from supermax.kr:', error);
            }
        }

        // 결과 데이터를 화면에 표시하는 함수 (실기종목이 있는 경우만 표시)
        function displayData(data) {
            const resultTableHead = document.getElementById('resultTableHead');
            const resultTableBody = document.getElementById('resultTableBody');
            resultTableHead.innerHTML = '';
            resultTableBody.innerHTML = '';

            if (data.length === 0) {
                return;
            }

            // 헤더 구성
            let headers = `
                <th>교육원</th>
                <th>이름</th>
                <th>학교</th>
                <th>성별</th>
                <th>학년</th>
                <th>환산내신</th>
                <th>등급</th>
                <th>실기점수</th>
                <th>총점</th>
                <th>최초합격여부</th>
                <th>최종합격여부</th>
            `;
            let maxPractical = 0;

            // 실기 항목이 있는지 확인하고 동적으로 헤더 추가
            for (let i = 1; i <= 6; i++) {
                const practicalField = `실기${i}종목`;
                if (data.some(row => row[practicalField])) {
                    headers += `<th>실기${i}종목</th><th>실기${i}기록</th><th>실기${i}점수</th>`;
                    maxPractical = i;
                }
            }

            resultTableHead.innerHTML = `<tr>${headers}</tr>`;

            // 데이터 행 구성
            data.forEach(row => {
                let rowHtml = `
                    <td>${row.교육원 || ''}</td>
                    <td>${row.이름 || ''}</td>
                    <td>${row.학교 || ''}</td>
                    <td>${row.성별 || ''}</td>
                    <td>${row.학년 || ''}</td>
                    <td>${row.환산내신 || ''}</td>
                    <td>${row.등급 || ''}</td>
                    <td>${row.실기점수 || ''}</td>
                    <td>${row.총점 || ''}</td>
                    <td>${row.최초합격여부 || ''}</td>
                    <td>${row.최종합격여부 || ''}</td>
                `;

                // 동적으로 실기 항목만 표시
                for (let i = 1; i <= maxPractical; i++) {
                    rowHtml += `
                        <td>${row[`실기${i}종목`] || ''}</td>
                        <td>${row[`실기${i}기록`] || ''}</td>
                        <td>${row[`실기${i}점수`] || ''}</td>
                    `;
                }

                resultTableBody.innerHTML += `<tr>${rowHtml}</tr>`;
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchDropdownData();

            document.getElementById('university').addEventListener('change', async () => {
                const university = document.getElementById('university').value;
                if (university) {
                    try {
                        const response = await fetch(`https://supermax.kr/25susi-majors?university=${university}`);
                        const data = await response.json();
                        populateDropdown('major', data.majors);
                    } catch (error) {
                        console.error('Error fetching majors from supermax.kr:', error);
                    }
                }
                fetchFilteredData(); // 필터링된 데이터를 자동으로 가져오기
            });

            document.getElementById('major').addEventListener('change', async () => {
                const university = document.getElementById('university').value;
                const major = document.getElementById('major').value;
                if (university && major) {
                    try {
                        const response = await fetch(`https://supermax.kr/25susi-admissionTypes?university=${university}&major=${major}`);
                        const data = await response.json();
                        populateDropdown('admissionType', data.admissionTypes);
                    } catch (error) {
                        console.error('Error fetching admission types from supermax.kr:', error);
                    }
                }
                fetchFilteredData(); // 필터링된 데이터를 자동으로 가져오기
            });

            document.getElementById('admissionType').addEventListener('change', fetchFilteredData);
        });
    </script>
</head>
<body>
    <h1>25수시 실시간 조회</h1>

    <label for="university">대학명:</label>
    <select id="university"></select><br>

    <label for="major">학과명:</label>
    <select id="major"></select><br>

    <label for="admissionType">전형명:</label>
    <select id="admissionType"></select><br>

    <table>
        <thead id="resultTableHead"></thead>
        <tbody id="resultTableBody"></tbody>
    </table>
</body>
</html>
